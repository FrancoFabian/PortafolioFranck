(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["fdfa1aa0e118170244e2663bb81af06f"],{qgfM:function(e,t,n){"use strict";n("pNMO");n("ma9I");n("TeQF");n("fbCW");n("yXV3");n("2B1R");n("ToJy");n("5DmW");n("FZtP");Object.defineProperty(t,"__esModule",{value:true});t.ReplyCollection=t.AnswerCollection=t.ProjectEvalAnswerModel=t.AnswerModel=t.ReplyModel=t.SuggestedClarificationCollection=t.SuggestedClarificationModel=t.DiscussionItemCollection=t.DiscussionItemModel=t.sanify=void 0;var l=i(n("e2gc"));var s=i(n("q1z7"));var r=i(n("F/us"));function i(e){return e&&e.__esModule?e:{default:e}}function a(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};var i=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}i.forEach(function(e){o(t,e,n[e])})}return t}function o(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}var c=function e(t){if(!t){return t}var n="abstain";if(t.upVoted){n="up"}else if(t.downVoted){n="down"}t.voteType=n;if(t.date){t.date=new Date(t.date)}t.author={kaid:t.authorKaid,nickname:t.authorNickname,avatarSrc:t.authorAvatarSrc};delete t.authorKaid;delete t.authorNickname;delete t.authorAvatarSrc;if(t.showLowQualityNotice){t.lowQualityNotice={authorKaid:t.author.kaid,translatedFeedbackEditTip:t.translatedFeedbackEditTip,translatedFeedbackType:"post",lowQualityScore:t.lowQualityScore};delete t.showLowQualityNotice;delete t.translatedFeedbackEditTip;delete t.lowQualityScore}t.shownLowQualityNotice=t.shownLowQualityNotice||false;delete t.upVoted;delete t.downVoted;delete t.isQuestion;delete t.isAnswer;delete t.isComment;delete t.isReply;delete t.isScratchpad;delete t.isClarification;delete t.numberOfFlags;return t};t.sanify=c;var u=s.default.Model.extend({idAttribute:"key",parse:c,defaults:{shownLowQualityNotice:false},urlRoutes:{createUpdate:function e(){var t="/api/internal/discussions/".concat(this.getFocusKind(),"/")+"".concat(this.getFocusId(),"/").concat(this.get("type"));if(this.isNew()){return"".concat(t,"?casing=camel")}return"".concat(t,"/").concat(this.id,"?casing=camel")},destroy:function e(){return"/api/internal/feedback/".concat(this.get("key"),"?casing=camel")}},toggleVote:function e(t,n){var i=this;var s=this.get("voteType");var r=this.get("sumVotesIncremented");var a={down:-1,abstain:0,up:1};var o=t;var c=a[t];if(t===s){o="abstain";c*=-1}var u=r+c;this.set({voteType:o,sumVotesIncremented:u});l.default.post("/api/internal/discussions/voteentity",{entity_key:this.id,vote_type:a[t]}).done(function(e){if(e&&e.error){i.set({voteType:s,sumVotesIncremented:r});n(e.error)}}).fail(function(){i.set({voteType:s,sumVotesIncremented:r});n("Log in first to vote")})},save:function e(t,n){this.unset("lowQualityNotice");n=n?(0,r.default)(n).clone():{};(0,r.default)(n).extend({url:this.urlRoutes.createUpdate.apply(this),parse:true});return s.default.Model.prototype.save.call(this,t,n)},destroy:function e(t){t=t?(0,r.default)(t).clone():{};(0,r.default)(t).extend({url:this.urlRoutes.destroy.apply(this),parse:true});if(this.get("inQueue")||this.userIsAuthor(t.profile)){return s.default.Model.prototype.destroy.call(this,t)}this.sync("delete",this,t);this.set("deleted",true)},undelete:function e(){var t=this;l.default.ajax({type:"PUT",url:"/api/internal/feedback/".concat(this.id,"/undelete?casing=camel"),contentType:"application/json"}).then(function(){t.set("deleted",false)})},convertTo:function e(t){var n=this;l.default.ajax({type:"PUT",url:"/api/internal/feedback/".concat(this.id,"/changetype?casing=camel"),contentType:"application/json",data:JSON.stringify({type:t}),dataType:"json"}).then(function(){n.set({flags:[],flaggedBy:[]})})},flag:function e(t,n){var i=this;var s={flag:t,justification:n,entity_key:this.id};l.default.ajax({type:"POST",url:"/api/internal/discussions/flagentity",dataType:"json",data:s}).then(function(){i.set("flaggedByUser",true)})},clearFlags:function e(){l.default.ajax({type:"PUT",url:"/api/internal/feedback/".concat(this.id,"/clearflags?casing=camel"),dataType:"json"})},markDuplicate:function e(){this.set("duplicateNotice",true)},unMarkDuplicate:function e(){this.unset("duplicateNotice")},userIsAuthor:function e(t){var n=this.get("author");return t&&n&&t.get("kaid")===n.kaid},getFocusKind:function e(){return this.get("focusKind")||this.get("focus")&&this.get("focus").kind},getFocusId:function e(){return this.get("focusId")||this.get("focus")&&this.get("focus").id},getTextContent:function e(){return this.get("content")||this.get("text")||""},getThumbnailUrl:function e(){if(this.getFocusKind()==="scratchpad"){return"".concat(this.get("focus").relativeUrl,"/latest.png")}return null},getFocusUrlWithExpandKey:function e(){return"".concat(this.get("focus").relativeUrl,"?qa_expand_key=").concat(this.id)},canHaveVotes:function e(){return this.get("type")!=="reply"&&this.get("type")!=="projecteval"&&this.get("type")!=="projectevalanswer"},canHaveReplies:function e(){return this.get("type")==="clarification"||this.get("type")==="projecthelp"||this.get("type")==="answer"},canHaveAnswers:function e(){return this.get("type")==="question"||this.isProjectFeedbackRequest()||this.isProjectEval()},isProjectFeedbackRequest:function e(){return this.get("type")==="projecthelp"||this.get("type")==="projectcritique"},isProjectHelp:function e(){return this.get("type")==="projecthelp"},isProjectEval:function e(){return this.get("type")==="projecteval"},isAnswer:function e(){return this.get("type")==="answer"},isProjectEvalAnswer:function e(){return this.get("type")==="projectevalanswer"},isEditable:function e(){return this.get("type")!=="scratchpad"&&this.get("type")!=="reply"&&this.get("type")!=="projecteval"&&this.get("type")!=="projectevalanswer"},isFlaggable:function e(){return!this.isProjectEval()&&!this.get("hideFlagControls")},hasAnswers:function e(){return this.get("answers")&&this.get("answers").some(function(e){return!e.deleted})},isPassingEvalAnswer:function e(){return this.get("sumVotesIncremented")>1}});t.DiscussionItemModel=u;var d=s.default.Collection.extend({model:u,initialize:function e(t,n){this.type=n.type;this.complete=true;this.focusKind=n.focusKind;this.focusId=n.focusId;this.topic=n.topic;this.maxAnswers=n.maxAnswers;this.minAnswers=n.minAnswers;this.shuffle=n.shuffle;this.sortOrder=n.sortOrder;this.autoRefresh=n.autoRefresh;this.fetchCount=n.fetchCount},fetch:function e(t){var n=this;var i=function e(){n.fetchedInitial=true;n.trigger("change");return t&&t.success&&t.success.apply(t,arguments)};return s.default.Collection.prototype.fetch.call(this,a({},t,{success:i}))},parse:function e(t){var n=this;var i=[];if(t.feedback){i=t.feedback;(0,r.default)(i).each(function(e){e.focus=e.focus||t.focus});this.cursor=t.cursor;this.complete=t.complete}else{i=t;(0,r.default)(i).each(function(e){e.focus={kind:n.focusKind,id:n.focusId}})}return i},findDuplicate:function e(t){var n=t.getTextContent().toLowerCase();return this.find(function(e){var t=e.getTextContent().toLowerCase();return t.indexOf(n)>-1})},removeDuplicateNotice:function e(){this.each(function(e){e.unMarkDuplicate()})},url:function e(){var t="/api/internal/";var n={casing:"camel",limit:this.fetchCount||10};if(this.focusId){t+="discussions/".concat(this.focusKind,"/").concat(this.focusId,"/").concat(this.type)}else{t+=this.type;n.topic=this.topic}if(this.cursor){n.cursor=this.cursor}if(this.maxAnswers!=null){n.max_answers=this.maxAnswers}if(this.minAnswers!=null){n.min_answers=this.minAnswers}if(this.sortOrder){n.sort=this.sortOrder}if(this.shuffle){n.shuffle=1}return t+"?"+l.default.param(n)},isAllProjectHelpAnswered:function e(){return this.every(function(e){return!e.isProjectHelp()||e.hasAnswers()})},hasEvalRequests:function e(){return this.some(function(e){return e.isProjectEval()})},hasEvaluatedEvalRequests:function e(){return this.some(function(e){return e.isProjectEval()&&e.hasAnswers()})},hasPassingEvalRequests:function e(){return this.some(function(e){return e.isProjectEval()&&e.get("answers")&&e.get("answers").some(function(e){return!e.deleted&&e.sumVotesIncremented>1})})},hasPendingEvalRequests:function e(){return this.some(function(e){return e.isProjectEval()&&!e.hasAnswers()})},hasHelpRequests:function e(){return this.some(function(e){return e.isProjectHelp()})},getOpenEvalRequest:function e(){return this.find(function(e){return e.isProjectEval()&&!e.hasAnswers()})},getEvalAnswer:function e(){var t;this.some(function(e){if(e.isProjectEval()){t=(0,r.default)(e.get("answers")).find(function(e){return!e.deleted})}return!!t});return t&&new g(t)},getPassingEvalAnswer:function e(){var t;this.some(function(e){if(e.isProjectEval()){t=(0,r.default)(e.get("answers")).find(function(e){return!e.deleted&&e.sumVotesIncremented>1})}return!!t});return t&&new g(t)},getBestEvalAnswer:function e(){var t=this.getPassingEvalAnswer();if(!t){t=this.getEvalAnswer()}return t},isComplete:function e(){return r.default.isUndefined(this.complete)?true:this.complete}},{fromItemAnswers:function e(n){var t=[];if(n.get("answers")){t=n.get("answers").map(function(e){var t=c(e);t.focus=n.get("focus");return t})}return new y(t,{focusKind:n.get("focus").kind,focusId:n.get("focus").id,type:"answer"})}});t.DiscussionItemCollection=d;var f=u.extend({urlRoutes:{createUpdate:function e(){return"/api/internal/discussions/"+this.get("focusKind")+"/"+this.get("focusId")+"/clarifications?casing=camel"},destroy:function e(){return"/api/internal/feedback/"+this.get("key")+"?casing=camel"}}},{forVideoModel:function e(t){return new f({focusKind:"youtubevideo",focusId:t.get("translatedYoutubeId"),content:""},{parse:true})},forArticleId:function e(t){return new f({focusKind:"article",focusId:t,content:""},{parse:true})}});t.SuggestedClarificationModel=f;var h=d.extend({model:f,url:function e(){if(this.articleId){return h.urlForArticleId(this.articleId)}return h.urlForYoutubeId(this.videoModel.get("translatedYoutubeId"))},initialize:function e(t,n){this.videoModel=n.videoModel;this.articleId=n.articleId},parse:function e(t){var n=t.feedback;(0,r.default)(n).each(function(e){e.focus=t.focus});return n}},{urlForYoutubeId:function e(t){return"/api/internal/discussions/youtubevideo/"+t+"/clarifications?casing=camel"},urlForArticleId:function e(t){return"/api/internal/discussions/article/"+t+"/clarifications?casing=camel"}});t.SuggestedClarificationCollection=h;var p=u.extend({save:function e(t,n){this.set({text:this.get("content"),content:undefined});return u.prototype.save.call(this,t,n)},urlRoutes:{createUpdate:function e(){return"/api/internal/discussions/"+this.get("parentKey")+"/replies?casing=camel"},destroy:function e(){return"/api/internal/feedback/"+this.get("key")+"?casing=camel&lang=en"}}});t.ReplyModel=p;var g=u.extend({answerType:"answers",save:function e(t,n){this.set({text:this.get("content"),content:undefined});return u.prototype.save.call(this,t,n)},urlRoutes:{createUpdate:function e(){var t="/api/internal/questions/"+"".concat(this.get("questionKey"),"/").concat(this.answerType);if(this.isNew()){return t+"?casing=camel"}return"".concat(t,"/").concat(this.get("key"),"?casing=camel")},destroy:function e(){return"/api/internal/feedback/"+"".concat(this.get("key"),"?casing=camel&lang=en")}}});t.AnswerModel=g;var v=g.extend({answerType:"projectevalanswers"});t.ProjectEvalAnswerModel=v;var y=d.extend({model:g,comparator:function e(t,n){var i=t.get("date");var s=n.get("date");return i<s?-1:i>s?1:0}});t.AnswerCollection=y;var w=d.extend({model:p,initialize:function e(t,n){this.parent=n.parent},url:function e(){return"/api/internal/discussions/"+"".concat(this.parent.id,"/replies?casing=camel")}},{fromItem:function e(t){return new w([],{parent:t})}});t.ReplyCollection=w}}]);
//# sourceMappingURL=../../sourcemaps/en/fdfa1aa0e118170244e2663bb81af06f.39a8d92cec39caedabfc.js.map