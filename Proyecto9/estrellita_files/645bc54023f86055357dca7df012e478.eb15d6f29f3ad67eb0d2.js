(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["645bc54023f86055357dca7df012e478"],{"z/9C":function(t,e,i){window["Handlebars"]=window["Handlebars"]||{};window["Handlebars"]["templates"]=window["Handlebars"]["templates"]||{};window["Handlebars"]["templates"]["tipbar"]=Handlebars.template({1:function(t,e,i,n,r){return"&times;"},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,r){var s,o,a,d=e!=null?e:t.nullContext||{},l=i.helperMissing,h="function",c=t.escapeExpression,u='<div class="tipbar">\n    <div class="speech-arrow"></div>\n    <div class="error-buddy"></div>\n\n    <div class="text-wrap">\n        <button class="close" type="button" aria-label="Close">';s=(o=(o=i.i18nDoNotTranslate||(e!=null?e.i18nDoNotTranslate:e))!=null?o:l,a={name:"i18nDoNotTranslate",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i.i18nDoNotTranslate){s=i.blockHelperMissing.call(e,s,a)}if(s!=null){u+=s}return u+'</button>\n        <div class="oh-no">'+c((o=(o=i.ohNoesMsg||(e!=null?e.ohNoesMsg:e))!=null?o:l,typeof o===h?o.call(d,{name:"ohNoesMsg",hash:{},data:r}):o))+'</div>\n        <div class="message"></div>\n        <div class="show-me"><a href>'+c((o=(o=i.showMeMsg||(e!=null?e.showMeMsg:e))!=null?o:l,typeof o===h?o.call(d,{name:"showMeMsg",hash:{},data:r}):o))+'</a></div>\n        <div class="tipnav">\n            <a href="javascript:void(0);" class="prev" title="'+c((o=(o=i.prevMsg||(e!=null?e.prevMsg:e))!=null?o:l,typeof o===h?o.call(d,{name:"prevMsg",hash:{},data:r}):o))+'">\n                <span class="ui-icon ui-icon-circle-triangle-w"></span>\n            </a>\n            <span class="current-pos"></span>\n            <a href="javascript:void(0);" class="next" title="'+c((o=(o=i.nextMsg||(e!=null?e.nextMsg:e))!=null?o:l,typeof o===h?o.call(d,{name:"nextMsg",hash:{},data:r}):o))+'">\n                <span class="ui-icon ui-icon-circle-triangle-e"></span>\n            </a>\n        </div>\n    </div>\n</div>'},useData:true});window.TipBar=Backbone.View.extend({initialize:function t(e){this.liveEditor=e.liveEditor;this.pos=0;this.errors=[];this.render();this.bind()},render:function t(){this.$overlay=$('<div class="overlay error-overlay" style="display: none"></div>').appendTo(this.$el);this.$el.append(Handlebars.templates["tipbar"]({ohNoesMsg:i18n._("\u00a1Ay caray!"),showMeMsg:i18n._("Mu\u00e9strame d\u00f3nde"),prevMsg:i18n._("Error anterior"),nextMsg:i18n._("Siguiente error")}));this.$bar=this.$el.find(".tipbar")},bind:function t(){var i=this;if($.fn.draggable){this.$el.find(".tipbar").draggable({containment:"parent",handle:".error-buddy",axis:"y"})}this.$el.on("click",".tipbar .tipnav a",function(t){if(!$(this).hasClass("ui-state-disabled")){i.pos+=$(this).hasClass("next")?1:-1;i.update()}i.liveEditor.editor.focus();return false});this.$el.on("click",".tipbar .show-me a",function(t){t.preventDefault();var e=i.errors[i.pos];i.liveEditor.editor.setCursor(e);i.liveEditor.editor.setErrorHighlight(true);return false});this.$el.on("click",".tipbar .close",function(t){i.liveEditor.setThinkingState()})},setErrors:function t(e){this.errors=e;this.update(false)},update:function t(e){if(!this.errors.length)return;var i=this.errors;var n=i[this.pos]==null?0:this.pos;this.$bar.find(".current-pos").text(i.length>1?n+1+"/"+i.length:"").end().find(".message").html(i[n].text||i[n]||"").end().find("a.prev").toggleClass("ui-state-disabled",n===0).end().find("a.next").toggleClass("ui-state-disabled",n+1===i.length).end();this.$el.find(".show-me").toggle(i[n].row>-1);this.$bar.find(".tipnav").toggle(i.length>1);if(e){this.$overlay.show();this.$bar.show()}},hide:function t(){this.$bar.hide();this.$overlay.hide();clearTimeout(this.errorDelay)},toggleErrors:function t(e,i){var n=e.length>0;if(!n){this.hide();return}this.$overlay.show();this.setErrors(e);clearTimeout(this.errorDelay);this.errorDelay=setTimeout(function(){this.update(true)}.bind(this),i)},setErrorPosition:function t(e){this.pos=e;this.update(true)}});window["Handlebars"]=window["Handlebars"]||{};window["Handlebars"]["templates"]=window["Handlebars"]["templates"]||{};window["Handlebars"]["templates"]["live-editor"]=Handlebars.template({1:function(t,e,i,n,r){return" no-output"},3:function(t,e,i,n,r){var s,o=e!=null?e:t.nullContext||{},a=i.helperMissing,d="function",l=t.escapeExpression;return'                <iframe id="output-frame"\n                    src="'+l((s=(s=i.execFile||(e!=null?e.execFile:e))!=null?s:a,typeof s===d?s.call(o,{name:"execFile",hash:{},data:r}):s))+'"\n                    data-src="'+l((s=(s=i.execFile||(e!=null?e.execFile:e))!=null?s:a,typeof s===d?s.call(o,{name:"execFile",hash:{},data:r}):s))+'"></iframe>\n'},5:function(t,e,i,n,r){return"Loading..."},7:function(t,e,i,n,r){return"Hmm..."},9:function(t,e,i,n,r){return"Restart"},11:function(t,e,i,n,r){return'                <a href="" class="draw-color-button" id="'+t.escapeExpression(t.lambda(e,e))+'">\n                    <span></span>\n                </a>\n'},13:function(t,e,i,n,r){return"Record"},15:function(t,e,i,n,r){return"Enable Flash to load audio:"},17:function(t,e,i,n,r){return"Play"},19:function(t,e,i,n,r){return"Loading audio..."},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,r){var s,o,a,d=e!=null?e:t.nullContext||{},l=i.helperMissing,h="function",c=t.escapeExpression,u=i.blockHelperMissing,f='<div class="scratchpad-wrap'+((s=i.unless.call(d,e!=null?e.execFile:e,{name:"unless",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r}))!=null?s:"")+'">\n    \x3c!-- Canvases (Drawing + Output) --\x3e\n    <div class="scratchpad-canvas-wrap">\n        <div id="output">\n            \x3c!-- Extra data-src attribute to work around\n                 cross-origin access policies. --\x3e\n'+((s=i["if"].call(d,e!=null?e.execFile:e,{name:"if",hash:{},fn:t.program(3,r,0),inverse:t.noop,data:r}))!=null?s:"")+'            <canvas class="scratchpad-draw-canvas" style="display:none;"\n                width="400" height="400"></canvas>\n\n            <div class="overlay disable-overlay" style="display:none;">\n            </div>\n\n            <div class="scratchpad-canvas-loading">\n                <img src="'+c((o=(o=i.imagesDir||(e!=null?e.imagesDir:e))!=null?o:l,typeof o===h?o.call(d,{name:"imagesDir",hash:{},data:r}):o))+'/spinner-large.gif">\n                <span class="hide-text">';s=(o=(o=i._||(e!=null?e._:e))!=null?o:l,a={name:"_",hash:{},fn:t.program(5,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i._){s=u.call(e,s,a)}if(s!=null){f+=s}f+='</span>\n            </div>\n        </div>\n\n        <div class="scratchpad-toolbar">\n            <div class="error-buddy-resting">\n                <div class="error-buddy-happy" style="display:none;">\n                    <img src="'+c((o=(o=i.imagesDir||(e!=null?e.imagesDir:e))!=null?o:l,typeof o===h?o.call(d,{name:"imagesDir",hash:{},data:r}):o))+'/creatures/OhNoes-Happy.png"/>\n                </div>\n                <a class="error-buddy-thinking" style="display:none;" href="javascript:void()">\n                    <img src="'+c((o=(o=i.imagesDir||(e!=null?e.imagesDir:e))!=null?o:l,typeof o===h?o.call(d,{name:"imagesDir",hash:{},data:r}):o))+'/creatures/OhNoes-Hmm.png"/>\n                    ';s=(o=(o=i._||(e!=null?e._:e))!=null?o:l,a={name:"_",hash:{},fn:t.program(7,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i._){s=u.call(e,s,a)}if(s!=null){f+=s}f+='\n                </a>\n            </div>\n            <button id="restart-code"\n                class="simple-button pull-right">\n                <span class="icon-refresh"></span>\n                ';s=(o=(o=i._||(e!=null?e._:e))!=null?o:l,a={name:"_",hash:{},fn:t.program(9,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i._){s=u.call(e,s,a)}if(s!=null){f+=s}f+='</button>\n\n            \x3c!-- Widgets for selecting colors to doodle on the canvas during\n                recordings --\x3e\n            <div id="draw-widgets" style="display:none;">\n                <a href="" id="draw-clear-button" class="ui-button">\n                    <span class="ui-icon-cancel"></span>\n                </a>\n'+((s=i.each.call(d,e!=null?e.colors:e,{name:"each",hash:{},fn:t.program(11,r,0),inverse:t.noop,data:r}))!=null?s:"")+'            </div>\n\n            \x3c!-- Record button --\x3e\n            <button id="record" class="simple-button pull-left" style="display:none;">';s=(o=(o=i._||(e!=null?e._:e))!=null?o:l,a={name:"_",hash:{},fn:t.program(13,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i._){s=u.call(e,s,a)}if(s!=null){f+=s}f+='</button>\n        </div>\n    </div>\n\n    \x3c!-- Editor --\x3e\n    <div class="scratchpad-editor-wrap overlay-container">\n        <div class="scratchpad-editor-tabs">\n          <div id="scratchpad-code-editor-tab" class="scratchpad-editor-tab">\n            <div class="scratchpad-editor scratchpad-ace-editor"></div>\n            <div class="overlay disable-overlay" style="display:none;">\n            </div>\n\n            <div class="scratchpad-editor-bigplay-loading" style="display:none;">\n                <img src="'+c((o=(o=i.imagesDir||(e!=null?e.imagesDir:e))!=null?o:l,typeof o===h?o.call(d,{name:"imagesDir",hash:{},data:r}):o))+'/spinner-large.gif">\n                <span class="hide-text">';s=(o=(o=i._||(e!=null?e._:e))!=null?o:l,a={name:"_",hash:{},fn:t.program(5,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i._){s=u.call(e,s,a)}if(s!=null){f+=s}f+='</span>\n            </div>\n\n            \x3c!-- This cannot be removed, if we want Flash to keep working! --\x3e\n            <div id="sm2-container">\n                ';s=(o=(o=i._||(e!=null?e._:e))!=null?o:l,a={name:"_",hash:{},fn:t.program(15,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i._){s=u.call(e,s,a)}if(s!=null){f+=s}f+='\n                <br>\n            </div>\n\n            <button class="scratchpad-editor-bigplay-button" style="display:none;">\n                <span class="icon-play"></span>\n                <span class="hide-text">';s=(o=(o=i._||(e!=null?e._:e))!=null?o:l,a={name:"_",hash:{},fn:t.program(17,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i._){s=u.call(e,s,a)}if(s!=null){f+=s}f+='</span>\n            </button>\n          </div>\n        </div>\n\n        <div class="scratchpad-toolbar">\n            \x3c!-- Row for playback controls --\x3e\n            <div class="scratchpad-playbar" style="display:none;">\n                <div class="scratchpad-playbar-area" style="display:none;">\n                    <button\n                        class="simple-button primary scratchpad-playbar-play"\n                        type="button">\n                        <span class="icon-play"></span>\n                    </button>\n\n                    <div class="scratchpad-playbar-progress"></div>\n\n                    <span class="scratchpad-playbar-timeleft"></span>\n                </div>\n                <div class="loading-msg">\n                    ';s=(o=(o=i._||(e!=null?e._:e))!=null?o:l,a={name:"_",hash:{},fn:t.program(19,r,0),inverse:t.noop,data:r},typeof o===h?o.call(d,a):o);if(!i._){s=u.call(e,s,a)}if(s!=null){f+=s}return f+'\n                </div>\n            </div>\n            <div class="scratchpad-debugger"></div>\n        </div>\n\n        <div class="scratchpad-toolbar scratchpad-dev-record-row" style="display:none;"></div>\n    </div>\n</div>'},useData:true});window.ScratchpadDrawCanvas=Backbone.View.extend({initialize:function t(e){this.record=e.record;this.isDrawing=false;this.ctx=this.el.getContext("2d");this.ctx.shadowBlur=2;this.ctx.lineCap="round";this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.clear(true);if(this.record){this.bindRecordView()}},commands:["startLine","drawLine","endLine","setColor","clear"],colors:{black:[0,0,0],red:[255,0,0],orange:[255,165,0],green:[0,128,0],blue:[0,0,255],lightblue:[173,216,230],violet:[128,0,128]},remove:function t(){this.clear(true);this.endDraw();this.$el.off(".draw-canvas");$(document).off(".draw-canvas")},bindRecordView:function t(){var n=this;var i=this.record;this.$el.on({"mousedown.draw-canvas":function t(e){if(i.recording&&e.button===0){n.startLine(e.offsetX,e.offsetY);e.preventDefault()}},"mousemove.draw-canvas":function t(e){if(i.recording){n.drawLine(e.offsetX,e.offsetY)}},"mouseup.draw-canvas":function t(e){if(i.recording){n.endLine()}},"mouseout.draw-canvas":function t(e){if(i.recording){n.endLine()}}});i.on("runSeek",function(){n.clear(true);n.endDraw()});i.seekCachers.canvas={getState:function t(){if(!n.isDrawing){return}var e=document.createElement("canvas");e.width=e.height=n.el.width;e.getContext("2d").drawImage(n.el,0,0);return{x:n.x,y:n.y,down:n.down,color:n.color,canvas:e}},restoreState:function t(e){n.startDraw();n.x=e.x;n.y=e.y;n.down=e.down;n.setColor(e.color);var i=n.ctx.shadowColor;n.ctx.shadowColor="rgba(0,0,0,0.0)";n.ctx.drawImage(e.canvas,0,0);n.ctx.shadowColor=i}};_.each(this.commands,function(t){i.handlers[t]=function(){n[t].apply(n,arguments)}})},startLine:function t(e,i){if(!this.down){this.down=true;this.x=e;this.y=i;this.record.log("startLine",e,i)}},drawLine:function t(e,i){if(this.down&&this.x!=null&&this.y!=null){this.ctx.beginPath();this.ctx.moveTo(this.x,this.y);this.ctx.lineTo(e,i);this.ctx.stroke();this.ctx.closePath();this.x=e;this.y=i;this.record.log("drawLine",e,i)}},endLine:function t(){if(this.down){this.down=false;this.record.log("endLine")}},setColor:function t(e){if(e!=null){if(!this.isDrawing){this.startDraw(true)}this.color=e;this.ctx.shadowColor="rgba("+this.colors[e]+",0.5)";this.ctx.strokeStyle="rgba("+this.colors[e]+",1.0)";this.record.log("setColor",e)}this.trigger("colorSet",e)},clear:function t(e){this.ctx.clearRect(0,0,600,480);this.x=null;this.y=null;this.down=false;if(e!==true){this.record.log("clear")}},startDraw:function t(e){if(this.isDrawing){return}this.isDrawing=true;if(e!==true){this.setColor("black")}this.trigger("drawStarted")},endDraw:function t(){if(!this.isDrawing){return}this.isDrawing=false;this.setColor(null);this.trigger("drawEnded")}});window.ScratchpadAudioChunks=Backbone.Model.extend({initialize:function t(e){this.audioChunks=[];this.currentChunk=null},setCurrentChunk:function t(e){this.currentChunk=e},currentChunkExists:function t(){return!_.isNull(this.currentChunk)},startNewChunk:function t(){this.currentChunk=null},discardCurrentChunk:function t(){this.currentChunk=null},saveCurrentChunk:function t(){if(!this.currentChunk){return}this.audioChunks.push(this.currentChunk);this.currentChunk=null},getAllChunks:function t(){return this.audioChunks}});window.ScratchpadRecordView=Backbone.View.extend({initialize:function t(e){this.render();this.$recordButton=e.recordButton;this.$finalSaveButton=e.saveButton;this.editor=e.editor;this.record=e.record;this.config=e.config;this.drawCanvas=e.drawCanvas;this.workersDir=e.workersDir;this.transloaditTemplate=e.transloaditTemplate;this.transloaditAuthKey=e.transloaditAuthKey;this.audioChunks=new ScratchpadAudioChunks;this.recordInProgress=false;this.commandChunks=[];this.startingCode="";this.lastSavedCode=this.editor.text();this.$lastAudioChunkElem=this.$el.find(".last-audio-chunk");this.$savedAudioChunksElem=this.$el.find(".saved-audio-chunks");this.initializeButtons()},render:function t(){this.$el.html(Handlebars.templates["dev-record"]({})).show()},initializeButtons:function t(){this.$newChunkButton=this.$el.find(".scratchpad-dev-new-chunk");this.$discardChunkButton=this.$el.find(".scratchpad-dev-discard-chunk");this.$saveChunkButton=this.$el.find(".scratchpad-dev-save-chunk");this.$refreshEditorButton=this.$el.find(".scratchpad-dev-refresh-editor-state");this.disableChunkButtons(true,true,true,true,false);this.$newChunkButton.on("click",_.bind(this.newChunk,this));this.$discardChunkButton.on("click",_.bind(this.discardChunk,this));this.$saveChunkButton.on("click",_.bind(this.saveChunk,this));this.$refreshEditorButton.on("click",_.bind(this.refreshEditor,this))},initializeRecordingAudio:function t(){this.multirecorder=new MultiRecorder({workerPath:this.workersDir+"shared/multirecorder-worker.js"});this.$recordButton.text("Use the chunks (and give permission)");this.setButtonDisableStatus(this.$recordButton,true);this.disableChunkButtons(false,true,true,true,true)},startRecordingAudio:function t(){var e=this;this.lastSavedCode=this.editor.text();this.multirecorder.startRecording(1).progress(_.bind(function(t){this.$newChunkButton.text(t+"...")},this)).done(_.bind(function(){this.disableChunkButtons(false,true,true,true,true);e.record.recordingAudio=true;this.$newChunkButton.html("Stop recording chunk");this.startRecordingCommands()},this))},stopRecordingAudio:function t(){this.multirecorder.stopRecording().done(_.bind(function(t){this.audioChunks.setCurrentChunk(t);this.$lastAudioChunkElem.html(t.createAudioPlayer())},this))},showSavedAudioChunks:function t(){this.getFinalAudioRecording(_.bind(function(t){this.$savedAudioChunksElem.html(t.createAudioPlayer())},this))},getDurationMsOfSavedAudio:function t(){var e=0;var i=$(this.$savedAudioChunksElem).find("audio");if(i&&i.length>0){e=i[0].duration*1e3}return e},startRecordingCommands:function t(){if(this.record.hasNoChunks()){this.startingCode=this.editor.text();var e=this.config.curVersion();this.config.switchVersion(e);this.record.setActualInitData({configVersion:e,code:this.startingCode})}this.editor.focus();this.record.startRecordChunk(this.getDurationMsOfSavedAudio());this.record.log("select",0,0);this.editor.setCursor({row:0,column:0})},stopRecordingCommands:function t(){this.record.stopRecordChunk()},getFinalAudioRecording:function t(e){this.multirecorder.combineRecordings(this.audioChunks.getAllChunks()).done(e)},getFinalCommandRecording:function t(){return this.record.dumpRecording()},newChunk:function t(){if(this.audioChunks.currentChunkExists()){return}if(!this.recordInProgress){this.editor.editor.setReadOnly(false);this.recordInProgress=true;this.startRecordingAudio()}else{this.recordInProgress=false;this.stopRecordingCommands();this.disableChunkButtons(true,false,false,true,true);this.$newChunkButton.html("Start new chunk")}},discardChunk:function t(e){if(!this.audioChunks.currentChunkExists()){return}this.audioChunks.discardCurrentChunk();this.record.discardRecordChunk();this.$lastAudioChunkElem.empty();this.refreshEditor()},saveChunk:function t(e){if(!this.audioChunks.currentChunkExists()){return}this.audioChunks.saveCurrentChunk();this.record.saveRecordChunk();this.lastSavedCode=this.editor.text();this.disableChunkButtons(false,true,true,false,false);this.showSavedAudioChunks();this.$lastAudioChunkElem.empty()},refreshEditor:function t(e){this.record.loadRecording(this.record.dumpRecording());this.editor.editor.setReadOnly(false);this.record.initData=this.record.actualInitData;if(this.record.commands){this.record.commands.push([this.getDurationMsOfSavedAudio(),"seek"])}this.record.time=0;this.editor.text(this.startingCode);this.drawCanvas.clear(true);this.drawCanvas.endDraw();this.record.seekTo(this.getDurationMsOfSavedAudio());setTimeout(_.bind(function(){this.disableChunkButtons(false,true,true,false,false)},this),1e3)},disableChunkButtons:function t(e,i,n,r,s){this.setButtonDisableStatus(this.$newChunkButton,e);this.setButtonDisableStatus(this.$discardChunkButton,i);this.setButtonDisableStatus(this.$saveChunkButton,n);this.setButtonDisableStatus(this.$refreshEditorButton,r);this.setButtonDisableStatus(this.$finalSaveButton,s)},setButtonDisableStatus:function t(e,i){if(!_.isUndefined(i)){e.prop("disabled",i)}}});$._=i18n._;window.LiveEditor=Backbone.View.extend({dom:{DRAW_CANVAS:".scratchpad-draw-canvas",DRAW_COLOR_BUTTONS:"#draw-widgets a.draw-color-button",CANVAS_WRAP:".scratchpad-canvas-wrap",EDITOR:".scratchpad-editor",CANVAS_LOADING:".scratchpad-canvas-loading",BIG_PLAY_LOADING:".scratchpad-editor-bigplay-loading",BIG_PLAY_BUTTON:".scratchpad-editor-bigplay-button",PLAYBAR:".scratchpad-playbar",PLAYBAR_AREA:".scratchpad-playbar-area",PLAYBAR_OPTIONS:".scratchpad-playbar-options",PLAYBAR_LOADING:".scratchpad-playbar .loading-msg",PLAYBAR_PROGRESS:".scratchpad-playbar-progress",PLAYBAR_PLAY:".scratchpad-playbar-play",PLAYBAR_TIMELEFT:".scratchpad-playbar-timeleft",PLAYBAR_UI:".scratchpad-playbar-play, .scratchpad-playbar-progress",OUTPUT_FRAME:"#output-frame",OUTPUT_DIV:"#output",ALL_OUTPUT:"#output, #output-frame",RESTART_BUTTON:"#restart-code",GUTTER_ERROR:".ace_error",ERROR_BUDDY_HAPPY:".error-buddy-happy",ERROR_BUDDY_THINKING:".error-buddy-thinking"},mouseCommands:["move","over","out","down","up"],colors:["black","red","orange","green","blue","lightblue","violet"],defaultOutputWidth:400,defaultOutputHeight:400,editors:{},initialize:function t(e){this.workersDir=this._qualifyURL(e.workersDir);this.externalsDir=this._qualifyURL(e.externalsDir);this.imagesDir=this._qualifyURL(e.imagesDir);this.soundsDir=e.soundsDir;this.execFile=e.execFile?this._qualifyURL(e.execFile):"";this.jshintFile=this._qualifyURL(e.jshintFile||this.externalsDir+"jshint/jshint.js");this.redirectUrl=e.redirectUrl;this.outputType=e.outputType||"";this.editorType=e.editorType||_.keys(this.editors)[0];this.editorHeight=e.editorHeight;this.initialCode=e.code;this.initialVersion=e.version;this.settings=e.settings;this.validation=e.validation;this.recordingCommands=e.recordingCommands;this.recordingMP3=e.recordingMP3;this.recordingInit=e.recordingInit||{code:this.initialCode,version:this.initialVersion};this.transloaditTemplate=e.transloaditTemplate;this.transloaditAuthKey=e.transloaditAuthKey;this.render();this.config=new ScratchpadConfig({version:e.version});this.record=new ScratchpadRecord;this.drawCanvas=new ScratchpadDrawCanvas({el:this.dom.DRAW_CANVAS,record:this.record});this.drawCanvas.on({drawStarted:function(){this.$el.find(this.dom.DRAW_CANVAS).show()}.bind(this),drawEnded:function(){this.$el.find(this.dom.DRAW_CANVAS).hide()}.bind(this),colorSet:function(t){this.$el.find(this.dom.DRAW_COLOR_BUTTONS).removeClass("ui-state-active");if(t!==null){this.$el.find("#"+t).addClass("ui-state-active")}}.bind(this)});this.newErrorExperience=e.newErrorExperience;if(window.location.search.indexOf("new_error_experience=yes")!==-1){this.newErrorExperience=true}if(e.enableLoopProtect!=null){this.enableLoopProtect=e.enableLoopProtect}else{this.enableLoopProtect=true}this.editor=new this.editors[this.editorType]({el:this.dom.EDITOR,code:this.initialCode,autoFocus:e.autoFocus,config:this.config,record:this.record,imagesDir:this.imagesDir,soundsDir:this.soundsDir,externalsDir:this.externalsDir,workersDir:this.workersDir,type:this.editorType});var n=this.config.editor.tooltipEngine;if(n.setEnabledStatus){if(window.location.search.indexOf("autosuggestToggle=yes")!==-1){window.localStorage["autosuggest"]="true";this.editor.editor.commands.addCommand({name:"toggleAutosuggest",bindKey:{win:"Ctrl+Alt+A",mac:"Command+Option+A"},exec:function t(e){var i=window.localStorage["autosuggest"]==="true";n.setEnabledStatus(i!==true);window.localStorage.setItem("autosuggest",String(i!==true))}})}else{n.setEnabledStatus("true")}}if(this.editorType==="ace_pjs"){this.noLint=false;this.editor.on("scrubbingStarted",function(){this.noLint=true}.bind(this));this.editor.on("scrubbingEnded",function(){this.noLint=false}.bind(this))}this.tipbar=new TipBar({el:this.$(this.dom.OUTPUT_DIV),liveEditor:this});var i=e.code;if(i!==undefined){this.editor.text(i);this.editor.originalCode=i}this.editor.focus();if(e.cursor){this.editor.setCursor(e.cursor)}else{this.editor.setSelection({start:{row:0,column:0},end:{row:0,column:0}})}this.$el.find("#page-overlay").hide();this.updateCanvasSize(e.width,e.height);if(this.canRecord()){this.$el.find("#record").show()}this.bind();this.setupAudio()},render:function t(){this.$el.html(Handlebars.templates["live-editor"]({execFile:this.execFile,imagesDir:this.imagesDir,colors:this.colors}))},bind:function t(){var e=this;var r=this;var i=this.$el;var n=this.dom;i.delegate(".simple-button.disabled, .ui-state-disabled","click",function(t){t.stopImmediatePropagation();return false});i.delegate(this.dom.RESTART_BUTTON,"click",this.restartCode.bind(this));this.handleMessagesBound=this.handleMessages.bind(this);$(window).on("message",this.handleMessagesBound);i.find("#output-frame").on("load",function(){e.outputState="clean";e.markDirty()});this.editor.on("change",function(){e.markDirty()});this.editor.on("userChangedCode",function(){if(!e.record.recording&&!e.record.playing){e.trigger("userChangedCode")}});this.on("runDone",this.runDone.bind(this));var s=function t(){if(r.outputState!=="clean"){r.once("runDone",t)}else{setTimeout(function(){if(r.editor.getSelectionIndices){r.postFrame({setCursor:r.editor.getSelectionIndices()})}r.editor.once("changeCursor",t)},0)}setTimeout(function(){r.maybeShowErrors()},0)};this.editor.once("changeCursor",s);this.config.on("versionSwitched",function(t,e){this.markDirty();this.config.runVersion(e,"jshint")}.bind(this));if(this.hasAudio()){i.find(".overlay").show();i.find(n.BIG_PLAY_LOADING).show();i.find(n.PLAYBAR).show()}i.find(n.DRAW_COLOR_BUTTONS).each(function(){$(this).addClass("ui-button").children().css("background",this.id)});if(jQuery.fn.buttonize){i.buttonize()}i.on("buttonClick","a.draw-color-button",function(){r.drawCanvas.setColor(this.id);r.editor.focus()});i.on("click",".disable-overlay",function(){r.record.pausePlayback()});i.find(n.PLAYBAR_PROGRESS).slider({range:"min",value:0,min:0,max:100,start:function t(){if(r.record.recording){return false}r.record.seeking=true;r.wasPlaying=r.record.playing;r.record.pausePlayback()},slide:function t(e,i){var n=i.value*1e3;if(n!==r.record.endTime()){r.updateTimeLeft(n);r.seekTo(n)}},stop:function t(e,i){r.record.seeking=false;r.updateTimeLeft(i.value*1e3);if(r.wasPlaying){setTimeout(function(){r.record.play()},1e3)}}});var o=function t(){if(r.record.playing){r.record.pausePlayback()}else{r.record.play()}};i.find(n.PLAYBAR_PLAY).off("click.play-button").on("click.play-button",o);var a=function t(){i.find(n.PLAYBAR_LOADING).hide();i.find(n.PLAYBAR_AREA).show();i.find(n.BIG_PLAY_BUTTON).off("click.big-play-button").on("click.big-play-button",function(){i.find(n.BIG_PLAY_BUTTON).hide();o()});i.find(n.PLAYBAR_PLAY).on("click",function(){i.find(n.BIG_PLAY_BUTTON).hide()});i.find(n.EDITOR).on("click",function(){i.find(n.BIG_PLAY_BUTTON).hide()});i.find(n.BIG_PLAY_LOADING).hide();i.find(n.BIG_PLAY_BUTTON).show();r.off("readyToPlay",t)};this.on("readyToPlay",a);i.on("buttonClick","#draw-clear-button",function(){r.drawCanvas.clear();r.drawCanvas.endDraw();r.editor.focus()});i.on("click",this.dom.RESTART_BUTTON,function(){r.record.log("restart")});i.on("click",this.dom.ERROR_BUDDY_THINKING,function(){r.setErrorPosition(0)});i.find("#record").on("click",function(){r.recordHandler(function(t){if(t){console.error(t)}})});if(this.recordingCommands){var d=this.recordingMP3;var l=/_x(1.\d+).mp3/.exec(d);var h=parseFloat(l&&l[1])||1;this.record.loadRecording({init:this.recordingInit,commands:this.recordingCommands,multiplier:h})}},remove:function t(){$(window).off("message",this.handleMessagesBound);this.editor.remove()},canRecord:function t(){return this.transloaditAuthKey&&this.transloaditTemplate},hasAudio:function t(){return!!this.recordingMP3},setupAudio:function t(){if(!this.hasAudio()){return}var i=this;var n;soundManager.setup({url:this.externalsDir+"SoundManager2/swf/",debugMode:false,useFlashBlock:true,onready:function t(){window.clearTimeout(n);i.audioInit()},ontimeout:function t(e){window.clearTimeout(n);n=window.setTimeout(function(){i.$el.find("#sm2-container div").remove();soundManager.reboot()},3e3)}});soundManager.beginDelayedInit();this.bindRecordHandlers()},audioInit:function t(){if(!this.hasAudio()){return}var e=this;var i=this.record;this.wasPlaying=undefined;i.time=0;this.player=soundManager.createSound({id:"sound"+(new Date).getTime(),url:this.recordingMP3,autoLoad:true,whileplaying:function(){e.updateTimeLeft(i.currentTime());if(!i.seeking){e.$el.find(e.dom.PLAYBAR_PROGRESS).slider("option","value",i.currentTime()/1e3)}i.trigger("playUpdate")}.bind(this),onplay:function t(){i.play()},onresume:function t(){i.play()},onpause:function t(){i.pausePlayback()},onload:function t(){i.durationEstimate=i.duration=this.duration;i.trigger("loaded")},whileloading:function t(){i.duration=null;i.durationEstimate=this.durationEstimate;i.trigger("loading")},onfinish:function t(){i.stopPlayback();i.trigger("playEnded")},onsuspend:function t(){e.trigger("readyToPlay")}});var n=setInterval(function(){if(e.audioReadyToPlay()){clearInterval(n);e.trigger("readyToPlay")}},16);this.bindPlayerHandlers()},audioReadyToPlay:function t(){return this.player&&(this.player.bytesLoaded>0||this.player.loaded)},bindPlayerHandlers:function t(){var i=this;var n=this.record;this.record.bind({loading:function t(){i.updateDurationDisplay()},loaded:function t(){var e=n.commands;if(e){e.push([Math.max(n.endTime(),e[e.length-1][0]),"seek"])}i.updateDurationDisplay()},playStarted:function t(){if(i.player.paused){i.player.resume()}else if(i.player.playState===0){i.player.play()}},playPaused:function t(){i.player.pause()}})},bindRecordHandlers:function t(){var n=this;var r=this.record;r.bind({playStarted:function t(e,i){n.config.switchVersion(r.getVersion());if(!r.recording&&!i){n.editor.reset(r.initData.code,false);n.drawCanvas.clear(true);n.drawCanvas.endDraw()}if(!r.recording){n.$el.find("#record").addClass("disabled")}n.$el.find(n.dom.RESTART_BUTTON).addClass("disabled");if(!r.recording){$("html").addClass("playing");n.$el.find(".disable-overlay").show()}n.editor.unfold();n.$el.find(n.dom.PLAYBAR_PLAY).find("span").removeClass("glyphicon-play icon-play").addClass("glyphicon-pause icon-pause")},playEnded:function t(){n.config.switchVersion(this.initialVersion)},playPaused:function t(){$("html").removeClass("playing");n.$el.find(".disable-overlay").hide();n.$el.find(n.dom.RESTART_BUTTON).removeClass("disabled");n.$el.find("#record").removeClass("disabled");n.$el.find(n.dom.PLAYBAR_PLAY).find("span").addClass("glyphicon-play icon-play").removeClass("glyphicon-pause icon-pause")},recordStarted:function t(){n.postFrame({recording:true});n.$el.find("#draw-widgets").removeClass("hidden").show();n.$el.find(".disable-overlay").hide();n.editor.setReadOnly(false);$("html").removeClass("playing");if(r.hasNoChunks()){n.drawCanvas.clear(true);n.drawCanvas.endDraw()}n.$el.find("#save-button, #fork-button").addClass("disabled");n.$el.find("#record").addClass("toggled")},recordEnded:function t(){n.postFrame({recording:false});if(r.recordingAudio){n.recordView.stopRecordingAudio()}n.$el.find("#save-button, #fork-button").removeClass("disabled");n.$el.find(n.dom.PLAYBAR_UI).removeClass("ui-state-disabled");n.$el.find("#record").removeClass("toggled disabled");r.stopPlayback();n.$el.find(".disable-overlay").show();$("html").addClass("playing");n.editor.setReadOnly(true);n.$el.find("#draw-widgets").addClass("hidden").hide();n.drawCanvas.endDraw()}});_.each(this.mouseCommands,function(i){r.handlers[i]=function(t,e){n.postFrame({mouseAction:{name:i,x:t,y:e}})}});r.handlers.restart=function(){var t=n.$el.find(n.dom.RESTART_BUTTON);if(!t.hasClass("hilite")){t.addClass("hilite green");setTimeout(function(){t.removeClass("hilite green")},300)}n.postFrame({restart:true})};r.currentTime=function(){return n.player?n.player.position:0};r.endTime=function(){return this.duration||this.durationEstimate}},recordHandler:function t(e){if(this.record.recording){this.recordView.stopRecordingCommands();return}var i=this.editor.text();if(!i){e({error:"empty"})}else if(this.config.curVersion()!==this.config.latestVersion()){e({error:"outdated"})}else if(this.canRecord()&&!this.hasAudio()){this.startRecording();this.editor.focus()}else{e({error:"exists"})}},startRecording:function t(){this.bindRecordHandlers();if(!this.recordView){var e=this.$el;var i=this.workersDir.replace(/^https?:\/\/[^\/]*/,"");this.recordView=new ScratchpadRecordView({el:e.find(".scratchpad-dev-record-row"),recordButton:e.find("#record"),saveButton:e.find("#save-button"),record:this.record,editor:this.editor,config:this.config,workersDir:i,drawCanvas:this.drawCanvas,transloaditTemplate:this.transloaditTemplate,transloaditAuthKey:this.transloaditAuthKey})}this.recordView.initializeRecordingAudio()},saveRecording:function t(e,i){if(!this.record.recorded||!this.record.recordingAudio){return e()}var n=new TransloaditXhr({authKey:this.transloaditAuthKey,templateId:this.transloaditTemplate,steps:i,successCb:function(t){this.recordingMP3=t.mp3[0].url.replace(/^http:/,"https:");e(null,this.recordingMP3)}.bind(this),errorCb:e});this.recordView.getFinalAudioRecording(function(t){n.uploadFile(t.wav)})},updateDurationDisplay:function t(){this.updateTimeLeft(this.record.currentTime());this.$el.find(this.dom.PLAYBAR_PROGRESS).slider("option","max",this.record.endTime()/1e3)},updateTimeLeft:function t(e){this.$el.find(".scratchpad-playbar-timeleft").text("-"+this.formatTime(this.record.endTime()-e))},formatTime:function t(e){var i=e/1e3,n=Math.floor(i/60),r=Math.floor(i%60);if(n<0||r<0){n=0;r=0}return n+":"+(r<10?"0":"")+r},seekTo:function t(e){if(!this.record.seeking){this.$el.find(this.dom.PLAYBAR_PROGRESS).slider("option","value",e/1e3)}if(this.record.seekTo(e)!==false){this.player.setPosition(e)}},handleMessages:function t(e){var i=e.originalEvent;var n;try{n=JSON.parse(i.data)}catch(t){}if(!n){return}if(typeof n!=="object"){return}this.trigger("update",n);if(n.loaded||n.results){this.$el.find(this.dom.CANVAS_LOADING).hide()}if(n.code!==undefined){this.editor.text(n.code);this.editor.originalCode=n.code;this.restartCode()}if(n.validate!==undefined&&n.validate!==null){this.validation=n.validate}if(n.results){this.trigger("runDone")}if(this.editorType.indexOf("ace_")===0&&n.results){this.removeUnderlineMarkers();if(n.results.assertions||n.results.warnings){var r=[];for(var s=0;s<n.results.assertions.length;s++){var o=n.results.assertions[s];r.push({row:+o.row,column:+o.column,text:o.text.toString(),type:"warning"});this.addUnderlineMarker(+o.row)}for(var s=0;s<n.results.warnings.length;s++){var a=n.results.warnings[s];r.push({row:+a.row,column:+a.column,text:a.text.toString(),type:"warning"});this.addUnderlineMarker(+a.row)}this.editor.editor.session.setAnnotations(r)}else{this.editor.editor.session.setAnnotations([])}}if(this.newErrorExperience&&this.errorState.length===0){this.setHappyState()}if(n.results&&_.isArray(n.results.errors)){this.handleErrors(this.cleanErrors(n.results.errors))}if(n.lines!==undefined){this.editor.toggleGutter(n.lines.map(function(t){return+t}))}if(n.restart){this.restartCode()}if(n.log){this.record.log.apply(this.record,n.log)}},addUnderlineMarker:function t(e){var i=ace.require("ace/range").Range;var n=this.editor.editor.session.getDocument().getLine(e);this.editor.editor.session.addMarker(new i(e,0,e,n.length),"ace_problem_line","text",false)},removeUnderlineMarkers:function t(){var e=this.editor.editor.session;var i=e.getMarkers();Object.keys(i).forEach(function(t){e.removeMarker(t)})},errorCursorRow:null,showError:null,handleErrors:function t(e){if(!this.newErrorExperience){this.tipbar.toggleErrors(e,1500);return}window.clearTimeout(this.errorTimeout);if(e.length){var i=this.editor.editor.session;this.removeUnderlineMarkers();this.setErrors(e);this.maybeShowErrors()}else{this.setErrors([]);this.setHappyState();this.showError=false;this.errorCursorRow=null}},maybeShowErrors:function t(){if(!this.hasErrors()||!this.editor||!this.editor.getCursor()){return}var e=this.editor.getCursor().row;var i=this.errorCursorRow===null||this.errorCursorRow===e;if(this.errorCursorRow===null){this.errorCursorRow=e}this.showError=this.showError||!i||this.showError===null;if(this.showError){this.setErrorState()}else if(i){this.setThinkingState();window.clearTimeout(this.errorTimeout);this.errorTimeout=setTimeout(function(){if(this.hasErrors()){this.setErrorState()}}.bind(this),6e4)}},errorState:"",hasErrors:function t(){return this.tipbar.errors.length},setErrors:function t(e){this.tipbar.setErrors(e)},setErrorPosition:function t(e){this.setErrorState();this.tipbar.setErrorPosition(e)},setErrorState:function t(){this.errorState="error";this.$el.find(this.dom.ERROR_BUDDY_THINKING).hide();this.$el.find(this.dom.ERROR_BUDDY_HAPPY).hide();this.tipbar.update(true)},setThinkingState:function t(){if(this.errorState!=="thinking"){this.errorState="thinking";this.tipbar.hide();this.$el.find(this.dom.ERROR_BUDDY_HAPPY).hide();this.$el.find(this.dom.ERROR_BUDDY_THINKING).show().animate({left:-2},{duration:300,easing:"linear"}).animate({left:2},{duration:300,easing:"linear"}).animate({left:0},{duration:300,easing:"linear"})}},setHappyState:function t(){this.errorState="happy";this.tipbar.hide();this.$el.find(this.dom.ERROR_BUDDY_THINKING).hide();this.$el.find(this.dom.ERROR_BUDDY_HAPPY).show()},postFrameOrigin:function t(){var e=/^.*:\/\/[^\/]*/.exec(this.$el.find("#output-frame").attr("data-src"));return e?e[0]:window.location.protocol+"//"+window.location.host},postFrame:function t(e){var i=this.$el.find("#output-frame")[0].contentWindow;if(i){i.postMessage(JSON.stringify(e),this.postFrameOrigin())}},hasFrame:function t(){return!!this.execFile},restartCode:function t(){this.postFrame({restart:true})},runCode:_.throttle(function(t){var e={code:arguments.length===0?this.editor.text():t,cursor:this.editor.getSelectionIndices?this.editor.getSelectionIndices():-1,validate:this.validation||"",noLint:this.noLint,version:this.config.curVersion(),settings:this.settings||{},workersDir:this.workersDir,externalsDir:this.externalsDir,imagesDir:this.imagesDir,soundsDir:this.soundsDir,redirectUrl:this.redirectUrl,jshintFile:this.jshintFile,outputType:this.outputType,enableLoopProtect:this.enableLoopProtect};this.trigger("runCode",e);this.postFrame(e)},20),markDirty:function t(){var e=this;if(!this.newErrorExperience){this.tipbar.hide()}if(this.outputState==="clean"){setTimeout(this.runCode.bind(this),0);this.outputState="running";this.runTimeout=setTimeout(function(){e.trigger("runDone")},500)}else{this.outputState="dirty"}},runDone:function t(){clearTimeout(this.runTimeout);var e=this.outputState;this.outputState="clean";if(e==="dirty"){this.markDirty()}},outputState:"dirty",updateCanvasSize:function t(e,i){e=e||this.defaultOutputWidth;i=i||this.defaultOutputHeight;this.$el.find(this.dom.CANVAS_WRAP).width(e);this.$el.find(this.dom.ALL_OUTPUT).height(i);this.$el.find(this.dom.EDITOR).height(this.editorHeight||i);this.trigger("canvasSizeUpdated",{width:e,height:i})},getScreenshot:function t(e){if(!this.hasFrame()){var i=document.createElement("canvas");i.width=200;i.height=200;var n=i.getContext("2d");var r=24;var s=190;var o=this.editor.text();o=o.replace(/<[^>]+>/g,"");o=o.replace(/&nbsp;|&#160;/g," ");o=o.replace(/&lt;|&#60;/g,"<");o=o.replace(/&gt;|&#62;/g,">");o=o.replace(/&amp;|&#38;/g,"&");o=o.replace(/&quot;|&#34;/g,'"');o=o.replace(/&apos;|&#39;/g,"'");var a=o.split(/\s+/);var d=0;var l=a[0];n.font=r+"px serif";for(var h=1;h<a.length;h++){var c=a[h];var u=n.measureText(l+" "+c).width;if(u<s){l+=" "+c}else{d+=1;n.fillText(l,5,(r+5)*d);l=c}}d+=1;n.fillText(l,5,(r+5)*d+5);e(i.toDataURL("image/png"));return}$(window).off("message.getScreenshot");$(window).on("message.getScreenshot",function(t){if(/^data:/.test(t.originalEvent.data)){e(t.originalEvent.data)}});this.postFrame({screenshot:true})},undo:function t(){this.editor.undo()},_qualifyURL:function t(e){var i=document.createElement("a");i.href=e;return i.href},cleanErrors:function t(e){var o={WhileStatement:i18n._("A <code>while</code> loop is taking too long to run."),DoWhileStatement:i18n._("A <code>do-while</code> loop is taking too long to run."),ForStatement:i18n._("A <code>for</code> loop is taking too long to run."),FunctionDeclaration:i18n._("A <code>function</code> is taking too long to run."),FunctionExpression:i18n._("A <code>function</code> is taking too long to run.")};e=e.map(function(e){delete e.html;var t=e.infiniteLoopNodeType;if(t){e.html=i18n._("%(typeMessage)s "+"Perhaps you have a mistake in your code?",{typeMessage:o[t]})}var i={};if(typeof e==="string"){i.text=this.clean(this.prettify(e))}else if(e.html){i.text=this.prettify(e.html)}else{i.text=this.prettify(this.clean(e.text||e.message||""))}if(e.lint!==undefined){i.lint={};var n=["character","line"];var r=["code","evidence","id","raw","reason","scope","type"];var s=["openTag"];n.forEach(function(t){if(e.lint[t]!=undefined){i.lint[t]=+e.lint[t]}});r.forEach(function(t){if(e.lint[t]!=undefined){i.lint[t]=e.lint[t].toString()}});s.forEach(function(t){if(e.lint[t]!=undefined){i.lint[t]=e.lint[t]}})}if(e.row!=undefined){i.row=+e.row}if(e.column!=undefined){i.column=+e.column}if(e.type!=undefined){i.type=e.type.toString()}if(e.source!=undefined){i.source=e.source.toString()}if(e.priority!=undefined){i.priority=+e.priority}return i}.bind(this));e=e.sort(function(t,e){var i=t.row-e.row;return i===0?(t.priority||99)-(e.priority||99):i});return e},prettify:function t(e){e=e.split('"');var i="";for(var n=0;n<e.length;n++){if(e[n].length===0){continue}if(n%2===0){i+='<span class="text">'+e[n]+"</span>"}else{i+='<span class="quote">'+e[n]+"</span>"}}return i},clean:function t(e){return String(e).replace(/</g,"&lt;")}});LiveEditor.registerEditor=function(t,e){LiveEditor.prototype.editors[t]=e};if(true){e.LiveEditor=LiveEditor}}}]);
//# sourceMappingURL=../../sourcemaps/en/645bc54023f86055357dca7df012e478.8c173be76f431b857897.js.map